import jsonlines
import json

gt_dict={}

with jsonlines.open("/mnt/workspace/o1_like/CaLM/deepseek_gen/dataset/NDE/train_gt.jsonl") as reader:
    for obj in reader:
        #print(obj)
        if obj.get("gt_answer"):
            gt_dict[obj["question"]]=obj["gt_answer"]

train_dataset=[]
with jsonlines.open("/mnt/workspace/o1_like/CaLM/deepseek_gen/answer_check/deepseek_NDE_check_output.jsonl") as reader:
    for obj in reader:
        if obj["check"] == "correct" and len(obj["answer"])> 30 and gt_dict.get(obj["question"]):
            train_dataset.append(obj)
#SAVE train_dataset
with jsonlines.open("/mnt/workspace/o1_like/CaLM/deepseek_gen/dataset/NDE/train_dataset.jsonl", mode='w') as writer:
    for obj in train_dataset:
        writer.write(obj)

with open("/mnt/workspace/o1_like/CaLM/deepseek_gen/dataset/NDE/train_dataset.json","w") as f:
    json.dump(train_dataset,f)

"""
{"question": "Input Info: Imagine a self-contained, hypothetical world with only the following conditions, and without any unmentioned factors or causal relationships: Ferk has a direct effect on tfmi. Rekt has a direct effect on tfmi.\nFor those with ferk being high, the probability of tfmi being low is 0.6043. For those with ferk being low, the probability of tfmi being low is 0.4924. \nInstruction: Consider the natural direct effect (NDE) of ferk on tfmi.\nQuestion: Suppose the mediator keeps constant when ferk is changed to be high, would the tfmi have been more likely to be low?\nProvide the calculation result to four decimal places and a final \"yes\" or \"no\" answer in JSON format, like {\"ANSWER\": \"Yes\", \"PROB\": \"0.1234\"}:", "process": "Step 1: Use symbols to represent each variable:  A represents ferk, B represents rekt and C represents tfmi.  киStep 2: Abstract a causal graph from the given input info: There is a causal graph with 3 nodes A, B, C, and 2 edges A->C, B->C. киStep 3: Abstract causal relations of variables from Input Info with math equations: P(C=0|A=1)=0.6043; P(C=0|A=0)=0.4924;  киStep 4: Check whether there is an edge from treatment (A) to outcome (C). The edge A->C exists. киStep 5: Find a valid mediator set: empty set. киStep 6: Find a valid backdoor adjustment set: empty set. киStep 7: NDE=P(C=0|A=1)-P(C=0|A=0) киStep 8: P(C=0|A=1)=0.6043\tP(C=0|A=0)=0.4924 киStep 9: NDE=0.6043-0.4924=0.1119 киStep 10: NDE=0.1119>0 so the answer is Yes. ки", "label": ["+", "+", "+", "+", "+", "+", "+", "+", "+", "+"], "steps": "NDE=0.1119>0 so the answer is Yes.", "answer": "Okay, let's tackle this problem. So, we need to find the natural direct effect (NDE) of Ferk on tfmi. The question is asking, if we change Ferk to high while keeping the mediator constant, would tfmi be more likely to be low.\n\nFirst, let's recall what NDE is. The natural direct effect measures the effect of changing the treatment (Ferk from low to high) while keeping the mediator (which here is Rekt, since Rekt has a direct effect on tfmi and is presumably the mediator) at its natural value under the original treatment. So, in other words, we set Ferk to high but let Rekt behave as if Ferk were low. Then, we compare the probability of tfmi being low under this scenario versus when Ferk is low and Rekt is at its natural value.\n\nWait, the problem states that both Ferk and Rekt have a direct effect on tfmi. So Rekt is a mediator here only if Ferk affects Rekt. Wait, but the input info says Ferk has a direct effect on tfmi, Rekt has a direct effect on tfmi. There's no mention of Ferk affecting Rekt. Hmm. Wait, maybe Rekt isn't a mediator here. Wait, maybe the mediator is something else? Wait, the input info only mentions Ferk and Rekt as direct causes of tfmi. But in the problem, when considering the NDE, the mediator would be Rekt only if Ferk affects Rekt. But according to the given conditions, Rekt has a direct effect on tfmi, but it's not stated that Ferk affects Rekt. Wait, perhaps there's a misunderstanding here. Let me re-read the input info.\n\nInput Info: \"Ferk has a direct effect on tfmi. Rekt has a direct effect on tfmi.\" So Ferk and Rekt both directly affect tfmi. There's no mention of Ferk affecting Rekt or vice versa. So in this scenario, the causal structure is Ferk → tfmi ← Rekt. So Rekt is not a mediator; it's another parent of tfmi. Therefore, in this case, if we are considering the natural direct effect of Ferk on tfmi, but the mediator here is not Rekt, because Ferk doesn't affect Rekt. Wait, this is confusing. The natural direct effect typically refers to the effect not mediated through any mediators. But if there are no mediators (since Ferk doesn't affect Rekt), then the total effect is the direct effect. Wait, maybe I'm getting this wrong. Let's think again.\n\nWait, the NDE is part of the causal mediation analysis. Mediation analysis decomposes the total effect into a direct effect (NDE) and an indirect effect (NIE) through a mediator. But in this case, if Ferk does not affect Rekt, then Rekt cannot be a mediator. So perhaps the problem is misphrased, or maybe the mediator is another variable not mentioned. Wait, the input info says the world has only the mentioned factors and relationships. So Ferk → tfmi and Rekt → tfmi. No other factors or relationships. Therefore, in this scenario, there's no mediator between Ferk and tfmi. So the direct effect of Ferk on tfmi is the total effect, because there's no indirect path. Therefore, the natural direct effect would just be the same as the total effect. But the question is about the NDE, so perhaps there's an implicit mediator here. Wait, maybe I'm missing something here. Let me check the problem statement again.\n\nThe problem says, \"Suppose the mediator keeps constant when ferk is changed to be high, would the tfmi have been more likely to be low?\" Wait, but according to the input info, the only variables are Ferk, Rekt, and tfmi. Ferk and Rekt both affect tfmi. But Rekt is not affected by Ferk, so Rekt cannot be a mediator. Mediators are variables that are affected by the treatment (Ferk) and in turn affect the outcome (tfmi). Since Ferk doesn't affect Rekt, Rekt can't be a mediator. So perhaps there's a misunderstanding here. Maybe the question is considering Rekt as a mediator, but that's incorrect. Alternatively, maybe there's another variable that's the mediator, but the input info says there are no unmentioned factors. Therefore, perhaps in this hypothetical world, the only possible mediator is Rekt, even though Ferk doesn't affect it. That would be a problem, but perhaps the question is assuming that Rekt is a mediator. But if Ferk doesn't affect Rekt, then keeping Rekt constant when changing Ferk would not involve any mediation. Therefore, the direct effect is just the effect of Ferk on tfmi, not going through any mediator. But the NDE is usually defined when there is a mediator. Hmm.\n\nWait, perhaps the problem is considering that even though Rekt is not affected by Ferk, the NDE is calculated by fixing Rekt to its value under some condition. But in standard causal inference, the natural direct effect is the effect of changing the treatment while setting the mediator to its value under the control condition. However, if the mediator is not affected by the treatment, then setting it to its natural value under control would just be its natural value, which is independent of the treatment. But in this case, since Rekt is not affected by Ferk, the mediator (Rekt) would be the same regardless of Ferk's value. Therefore, the NDE would be the effect of Ferk on tfmi while Rekt is kept at its natural value (which is the same as Rekt's value because Ferk doesn't affect it). So in that case, the NDE would be the same as the total effect, which is the difference in probabilities of tfmi being low when Ferk is high versus low, given that Rekt is whatever it naturally is. However, the data given is for the probabilities of tfmi being low when Ferk is high or low, but we don't know about Rekt's distribution. Wait, the input info gives:\n\n\"For those with ferk being high, the probability of tfmi being low is 0.6043. For those with ferk being low, the probability of tfmi being low is 0.4924.\"\n\nSo these are the observed probabilities. If Rekt is a confounder, or if Rekt is affected by Ferk, but according to the input info, Ferk does not affect Rekt. So Rekt is just another parent of tfmi. Therefore, the observed probabilities are marginal over Rekt. So the difference between 0.6043 and 0.4924 is the total effect of Ferk on tfmi. But the question is about the natural direct effect. But since there's no mediator (because Ferk doesn't affect Rekt), the NDE should be the same as the total effect. But maybe the problem is considering Rekt as a mediator, even though it's not affected by Ferk. That would be a mistake, but perhaps we have to proceed with that assumption.\n\nAlternatively, perhaps the problem is considering that even though Rekt isn't affected by Ferk, when computing the NDE, we are supposed to fix Rekt to its value under the control (Ferk low) when Ferk is set to high. But Rekt's value is not influenced by Ferk, so setting Ferk to high doesn't change Rekt. Therefore, the NDE would be the effect of Ferk on tfmi while Rekt remains as it is. Therefore, the probability of tfmi being low when Ferk is high, with Rekt at its natural value (which is the same as when Ferk is low, since Rekt isn't affected). Wait, but in reality, Rekt's distribution might be different between the two groups if Rekt is a confounder. Wait, no, because the problem states there are no unmentioned factors or causal relationships. So Ferk and Rekt are independent? Because there's no causal link between them. Therefore, in the population, Ferk and Rekt are independent. Therefore, when Ferk is high or low, the distribution of Rekt is the same. Therefore, the observed probabilities of tfmi being low given Ferk high or low already account for Rekt's distribution. Therefore, the total effect is the difference between these two probabilities. But the NDE, in this case, since there's no mediator, would be the same as the total effect. Therefore, the NDE is 0.6043 - 0.4924 = 0.1119. So if we set Ferk to high while keeping the mediator (which doesn't exist) constant, then the probability increases by approximately 0.1119. Therefore, the probability of tfmi being low would be higher when Ferk is high, so the answer is yes.\n\nWait, but the problem specifically mentions the mediator. Even though in reality there is no mediator, the question is phrased as if there is a mediator. So perhaps the mediator here is Rekt, even though Ferk doesn't affect it. But that's a bit of a contradiction. Let me try to think again.\n\nIn standard mediation analysis, the mediator M is affected by the treatment T and affects the outcome Y. The natural direct effect (NDE) is the effect of T on Y while setting M to its natural value under the control condition (T=0). The natural indirect effect (NIE) is the effect through M. But if T doesn't affect M, then NIE is zero, and NDE equals the total effect.\n\nIn this problem, since Ferk (T) does not affect Rekt (M), the NDE would be the same as the total effect. So when the problem asks, \"Suppose the mediator keeps constant when Ferk is changed to be high, would the tfmi have been more likely to be low?\"—since Rekt is the mediator but isn't affected by Ferk, keeping it constant (which it already is) means that the effect is just the direct effect, which is the total effect. The observed probabilities when Ferk is high vs. low are 0.6043 and 0.4924 respectively. So changing Ferk from low to high increases the probability of tfmi being low by 0.6043 - 0.4924 = 0.1119. Therefore, the answer is yes, more likely.\n\n\n{\"ANSWER\": \"Yes\", \"PROB\": \"0.1119\"}", "dup_id": 2, "global_id": 395, "check": "correct"}

"""